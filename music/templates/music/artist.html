{% extends 'base.html' %}
{% load humanize %}
{% load static %}
{% block title %}
  {{ artist.name }} - Artist Details
{% endblock %}
{% block content %}
  <link rel="stylesheet" type="text/css" href="{% static 'css/artist.css' %}" />
  <div class="artist-detail card mb-4">
    <div class="card-body">
      <div class="row">
        <!-- Artist Details -->
        <div class="col-md-4">
          <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}" class="img-fluid rounded" />
          <p class="card-text text-white mt-3">Followers: {{ artist.followers.total|intcomma }}</p>
          <p class="card-text text-white">Popularity: {{ artist.popularity }}/100</p>
          <a href="{{ artist.external_urls.spotify }}" class="btn btn-primary" target="_blank">View on Spotify</a>
          <div class="mb-3">
            <a href="{% url 'music:artist_all_songs' artist.id %}" class="btn btn-primary all-songs">All Songs</a>
          </div>
        </div>
        <!-- Top Genres -->
        <div class="col-md-8">
          <h1 class="card-title text-white">{{ artist.name }}</h1>
          <h5 class="mt-3 text-white">Top Genres</h5>
          <div class="card-text genres-section">
            {% for genre in artist.genres %}
              <span class="badge badge-secondary genre-badge"><a href="{% url 'music:genre' genre %}" class="text-white">{{ genre }}</a></span>
            {% endfor %}
          </div>
          <h5 class="mt-3 text-white">Top 5 Songs</h5>
          <ul class="list-group mb-3">
            {% for track in top_tracks %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <a href="{% url 'music:album' track.album.id %}"><img src="{{ track.album.images.0.url }}" alt="{{ track.name }}" /></a>
                <div class="flex-grow-1">
                  <span>
                    <td>
                      <a href="{% url 'music:track' track.id %}" class="text-white">{{ track.name }}</a>
                    </td>
                  </span>
                  <br />
                  <small><a href="{% url 'music:album' track.album.id %}">{{ track.album.name }}</a></small>
                </div>
                {% if track.preview_url %}
                  <audio controls>
                    <source src="{{ track.preview_url }}" type="audio/mpeg" />Your browser does not support the audio element.
                  </audio>
                {% else %}
                  <span class="text-muted">No preview available</span>
                {% endif %}
                <span class="badge badge-primary badge-pill">Popularity: {{ track.popularity }}/100</span>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
      <!-- Albums Section -->
      <h4 class="mt-3 text-white">Albums</h4>
      <div class="container-fluid py-2">
        <div class="d-flex flex-row flex-nowrap album-scroll-container">
          {% for album in albums %}
            <div class="card album-card">
              <a href="{% url 'music:album' album.id %}">
                <img src="{{ album.images.0.url }}" alt="{{ album.name }}" class="album-img" />
                <div class="album-info">
                  <span class="text-white">{{ album.name }}</span>
                  <p>{{ album.release_date|slice:':4' }}</p>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
      <!-- Similar Artists -->
      {% if similar_artists %}
        <div class="row mb-4">
          <div class="col">
            <h4 class="mt-3 text-white">Other Artists you might like</h4>
            <div class="container-fluid py-2">
              <div class="d-flex flex-row flex-nowrap album-scroll-container">
                {% for similar_artist in similar_artists %}
                  <div class="card album-card">
                    <a href="{% url 'music:artist' similar_artist.id %}">
                      <img src="{{ similar_artist.images.0.url }}" alt="{{ similar_artist.name }}" class="album-img" />
                      <div class="album-info">
                        <span class="text-white">{{ similar_artist.name }}</span>
                        {% if similar_artist.genres %}
                          <p>{{ similar_artist.genres.0|title }}</p>
                        {% endif %}
                      </div>
                    </a>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
